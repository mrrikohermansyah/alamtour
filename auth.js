let app=null;let auth=null;let allowedEmails=[];
function hasConfig(c){return !!(c&&c.apiKey&&c.authDomain&&c.projectId&&c.appId);} 
function init(){var cfg=window.FIREBASE_CONFIG;if(!hasConfig(cfg)){window.__AUTH_ERR='Konfigurasi Firebase belum diisi';return;}app=firebase.initializeApp(cfg);auth=firebase.auth();}
function onAdminAuth(){if(!auth){location.href='login.html';return;}auth.onAuthStateChanged(u=>{if(!u){location.href='login.html';return;}if(allowedEmails.length&&allowedEmails.indexOf(u.email)===-1){auth.signOut().then(()=>{location.href='login.html';});return;}var el=document.getElementById('user-email');if(el){el.textContent=u.email;}if(typeof window.onAuthReady==='function'){window.onAuthReady(u);}});} 
function bindLogin(){const email=document.getElementById('email');const password=document.getElementById('password');const btn=document.getElementById('btn-login');const btnGoogle=document.getElementById('btn-google');const msg=document.getElementById('login-msg');if(window.__AUTH_ERR){msg.textContent=window.__AUTH_ERR;btn.disabled=true;btnGoogle.disabled=true;return;}btn.addEventListener('click',()=>{msg.textContent='';auth.signInWithEmailAndPassword(email.value,password.value).then(()=>{location.href='admin.html';}).catch(e=>{msg.textContent='Login gagal: '+(e.code||e.message);});});
btnGoogle.addEventListener('click',()=>{msg.textContent='';const provider=new firebase.auth.GoogleAuthProvider();auth.signInWithPopup(provider).then(()=>{location.href='admin.html';}).catch(e=>{msg.textContent='Login gagal: '+(e.code||e.message);});});}
function logout(){auth.signOut().then(()=>{location.href='login.html';});}
window.logout=logout;
document.addEventListener('DOMContentLoaded',()=>{init();if(location.pathname.endsWith('admin.html')){onAdminAuth();const out=document.getElementById('btn-logout');if(out){out.addEventListener('click',logout);} }else if(location.pathname.endsWith('login.html')){if(auth){auth.onAuthStateChanged(u=>{if(u){location.href='admin.html';}});}bindLogin();}});