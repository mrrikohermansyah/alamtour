let __db=null;let __app=null;let __available=false;function __hasCfg(c){return !!(c&&c.apiKey&&c.authDomain&&c.projectId&&c.appId);}function initDb(){var cfg=window.FIREBASE_CONFIG;if(!__hasCfg(cfg)){__available=false;return;}if(firebase.apps&&firebase.apps.length){__app=firebase.app();}else{__app=firebase.initializeApp(cfg);}__db=firebase.firestore();__available=true;}function subscribePackages(cb){if(!__available){cb(null);return;}return __db.collection('packages').onSnapshot(s=>{const arr=[];s.forEach(d=>{const v=d.data();arr.push({...v,id:d.id});});cb({packages:arr});},e=>{cb(null);});}function addPackage(m){if(!__available)return Promise.reject('no-db');const id=m.id||null;const data={...m};if(id){delete data.id;return __db.collection('packages').doc(id).set(data,{merge:true});}else{return __db.collection('packages').add(data).then(ref=>ref.update({id:ref.id}));}}function updatePackage(id,m){if(!__available)return Promise.reject('no-db');const data={...m};delete data.id;return __db.collection('packages').doc(id).set(data,{merge:true});}function deletePackage(id){if(!__available)return Promise.reject('no-db');return __db.collection('packages').doc(id).delete();}function subscribeSettings(cb){if(!__available){cb(null);return;}return __db.collection('settings').doc('site').onSnapshot(d=>{cb(d.exists?d.data():{});},e=>{cb(null);});}function updateSettings(p){if(!__available)return Promise.reject('no-db');return __db.collection('settings').doc('site').set(p,{merge:true});}initDb();window.db={available:__available,subscribePackages,addPackage,updatePackage,deletePackage,subscribeSettings,updateSettings};